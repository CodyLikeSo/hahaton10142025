services:

  hahaton_db:
    image: postgres:17
    container_name: hahaton_db
    environment:
      - POSTGRES_DB=${HAHATON_DB_DBNAME}
      - POSTGRES_USER=${HAHATON_DB_USER}
      - POSTGRES_PASSWORD=${HAHATON_DB_PASSWORD}
    ports:
      - "$HAHATON_DB_PORT:5432"
    shm_size: 1gb
    volumes:
      - ./data/pg:/var/lib/postgresql/data
      - ./sql/init-database.sql:/docker-entrypoint-initdb.d/init-database.sql
    networks:
      - hahaton-network

  hahaton_qdrant:
    image: qdrant/qdrant:latest
    container_name: hahaton_qdrant
    ports:
      - "$HAHATON_QDRANT_PORT_HTTP:6333"
      - "$HAHATON_QDRANT_PORT_GRPC:6334"
    expose: 
      - $HAHATON_QDRANT_PORT_HTTP
    volumes:
      - ./data/qdrant:/qdrant/storage
    configs:
      - source: hahaton_qdrant_config
        target: /qdrant/config/production.yaml
    networks:
      - hahaton-network

  hahaton_python:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: hahaton_python
    environment:
      - HAHATON_PYTHON_SKIBOX_API_KEY=${HAHATON_PYTHON_SKIBOX_API_KEY}
      - HAHATON_QDRANT_API_KEY=${HAHATON_QDRANT_API_KEY}
    ports:
      - "$HAHATON_PYTHON_API_PORT:8000"
    expose:
      - $HAHATON_PYTHON_API_PORT
    depends_on:
      - hahaton_db
      - hahaton_qdrant
    networks:
      - hahaton-network

  hahaton_front:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: hahaton_front
    ports:
      - "$HAHATON_FRONT_API_PORT:3000"
    expose: 
      - $HAHATON_FRONT_API_PORT
    networks:
      - hahaton-network

networks:
  hahaton-network:

configs:
  hahaton_qdrant_config:
    content: |
      # api_key: ${HAHATON_QDRANT_API_KEY}